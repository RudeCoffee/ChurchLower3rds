<!DOCTYPE html>
<head>

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: transparent;
        }
       #bibleContainer.bible {
            position: absolute;
            bottom: 20px;
            left: 20px;
            width: calc(100% - 40px);
            background-color: #224269;
            display: flex;
            align-items: center;
            padding: 20px;
            border-radius: 15px;
            box-sizing: border-box;
            color: white;
            font-family: Arial, sans-serif;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        #logo {
            width: 110px;
            height: 110px;
            margin-right: 20px;
            flex-shrink: 0;
        }

        #bibleTextContainer {
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #bibleBook {
            font-size: 38px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        #bibleVerse {
            font-size: 34px;
            line-height: 1.3;
        }
        .speaker {
            position: absolute;
            font-family: Arial, sans-serif;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.7);
            transition: opacity 1s ease-in-out;
            opacity: 0;
        }
        #speakerText {
            bottom: 25px;
            left: 10px;
            font-size: 70px;
            font-weight: bold;
            width: calc(100% - 20px);
            text-align: center;
            z-index: 1;
        }
        #speakerBackground {
            bottom: 10px;
            left: 10px;
            width: calc(100% - 20px);
            height: 120px;
            background-color: rgba(0, 0, 0, 0.85);
            z-index: -1;
            border-radius: 8px;
        }
        .visible {
            opacity: 1 !important;
        }
    </style>


</head>
<body>
    <div id="bibleContainer" class="bible">
        <img id="logo" src="logoTransparent.png" alt="Logo">
        <div id="bibleTextContainer">
            <div id="bibleBook"></div>
            <div id="bibleVerse"></div>
        </div>
    </div>
    
    <div id="speakerText" class="speaker">Pastor John</div>
    <div id="speakerBackground" class="speaker"></div>

    <script>
        const ws = new WebSocket('ws://localhost:8080/ws/obs');
        
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            
            if (data.type === 'bible') {
                const bibleElements = document.querySelectorAll('.bible');
                const speakerElements = document.querySelectorAll('.speaker');
                
                if (data.show) {
                    // Hide speaker first if it's visible
                    if (document.querySelector('.speaker.visible')) {
                        speakerElements.forEach(el => el.classList.remove('visible'));
                        setTimeout(() => {
                            document.getElementById('speakerText').textContent = '';
                        }, 1000);
                    }
                    
                    // Set text content first
                    document.getElementById('bibleBook').textContent = data.book || '';
                    document.getElementById('bibleVerse').textContent = data.verse || '';
                    
                    // Show bible verse
                    setTimeout(() => {
                        bibleElements.forEach(el => el.classList.add('visible'));
                    }, 10);
                } else {
                    // Start fade out first
                    bibleElements.forEach(el => el.classList.remove('visible'));
                    // Clear text after fade animation completes (1 second)
                    setTimeout(() => {
                        document.getElementById('bibleBook').textContent = '';
                        document.getElementById('bibleVerse').textContent = '';
                    }, 1000);
                }
            } else if (data.type === 'speaker') {
                const speakerElements = document.querySelectorAll('.speaker');
                const bibleElements = document.querySelectorAll('.bible');
                
                if (data.show) {
                    // Hide bible verse first if it's visible
                    if (document.querySelector('.bible.visible')) {
                        bibleElements.forEach(el => el.classList.remove('visible'));
                        setTimeout(() => {
                            document.getElementById('bibleBook').textContent = '';
                            document.getElementById('bibleVerse').textContent = '';
                        }, 1000);
                    }
                    
                    // Set text content first, then show speaker
                    document.getElementById('speakerText').textContent = data.speaker || '';
                    speakerElements.forEach(el => el.classList.add('visible'));
                } else {
                    // Start fade out first
                    speakerElements.forEach(el => el.classList.remove('visible'));
                    // Clear text after fade animation completes (1 second)
                    setTimeout(() => {
                        document.getElementById('speakerText').textContent = '';
                    }, 1000);
                }
            }
        };
        
        ws.onopen = function() {
            console.log('Connected to server');
        };
        
        ws.onclose = function() {
            console.log('Disconnected from server');
            // Attempt to reconnect after 3 seconds
            setTimeout(() => {
                location.reload();
            }, 3000);
        };
    </script>
</body>
</html>