<!DOCTYPE html>
<head>
    <title>Church Lower 3rds Control</title>
    <style>
        :root {
            --bg-color: #2b2b2b;
            --container-bg: #3c3c3c;
            --text-color: #e0e0e0;
            --border-color: #555;
            --input-bg: #4a4a4a;
            --button-bg: #007cba;
            --button-hover: #005a87;
            --danger-bg: #dc3545;
            --danger-hover: #c82333;
            --success-bg: #28a745;
            --success-border: #1e7e34;
            --preview-bg: #454545;
            --dropdown-bg: #3c3c3c;
        }

        .light-mode {
            --bg-color: #f5f5f5;
            --container-bg: white;
            --text-color: #333;
            --border-color: #ddd;
            --input-bg: white;
            --button-bg: #007cba;
            --button-hover: #005a87;
            --danger-bg: #dc3545;
            --danger-hover: #c82333;
            --success-bg: #d4edda;
            --success-border: #c3e6cb;
            --preview-bg: #f8f9fa;
            --dropdown-bg: white;
        }

        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            background: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            transition: background-color 0.3s;
        }
        h1, h2 {
            color: var(--text-color);
            margin-top: 0;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-color);
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            background-color: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
        }
        .verse-selector {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .verse-navigation {
            display: grid;
            grid-template-columns: 1fr auto auto auto 1fr;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        .nav-button {
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: 80px;
        }
        .nav-button:hover {
            background-color: var(--button-hover);
        }
        .nav-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 16px;
            width: 50px;
            height: 50px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            transition: background-color 0.3s;
        }
        .theme-toggle:hover {
            background-color: var(--button-hover);
        }
        .autocomplete-container {
            position: relative;
        }
        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--dropdown-bg);
            border: 1px solid var(--border-color);
            border-top: none;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            transition: background-color 0.3s;
        }
        .autocomplete-item {
            padding: 8px;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }
        .autocomplete-item:hover {
            background-color: var(--preview-bg);
        }
        .autocomplete-item.selected {
            background-color: var(--button-bg);
            color: white;
        }
        button {
            background-color: var(--button-bg);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--button-hover);
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        button.hide {
            background-color: var(--danger-bg);
        }
        button.hide:hover {
            background-color: var(--danger-hover);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .status.connected {
            background-color: var(--success-bg);
            color: var(--text-color);
            border: 1px solid var(--success-border);
        }
        .status.disconnected {
            background-color: var(--danger-bg);
            color: white;
            border: 1px solid var(--danger-hover);
        }
        .verse-preview {
            background-color: var(--preview-bg);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            display: none;
            transition: background-color 0.3s, border-color 0.3s;
        }
        .verse-preview h3 {
            margin-top: 0;
            color: var(--button-bg);
        }
        .verse-text {
            font-style: italic;
            line-height: 1.5;
            color: var(--text-color);
        }
        .search-results {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            margin-top: 10px;
            background-color: var(--container-bg);
            transition: background-color 0.3s, border-color 0.3s;
        }
        .search-result {
            padding: 10px;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            color: var(--text-color);
        }
        .search-result:hover {
            background-color: var(--preview-bg);
        }
        .search-result:last-child {
            border-bottom: none;
        }
        .verse-reference {
            font-weight: bold;
            color: var(--button-bg);
        }
    </style>
</head>
<body class="light-mode">
    <button class="theme-toggle" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
    
    <div class="status" id="status">Connecting...</div>
    
    <div class="container">
        <h1>Church Lower 3rds Control</h1>
        
        <h2>Bible Verse Display</h2>
        <div class="verse-selector">
            <div class="autocomplete-container">
                <label for="bookInput">Book</label>
                <input type="text" id="bookInput" placeholder="Type book name..." autocomplete="off">
                <div class="autocomplete-dropdown" id="bookDropdown"></div>
            </div>
            
            <div>
                <label for="chapterSelect">Chapter</label>
                <select id="chapterSelect" disabled>
                    <option value="">Select chapter</option>
                </select>
            </div>
            
            <div>
                <label for="verseSelect">Verse</label>
                <select id="verseSelect" disabled>
                    <option value="">Select verse</option>
                </select>
            </div>
        </div>
        
        <div class="verse-navigation">
            <div></div>
            <button class="nav-button" onclick="previousVerse()" id="prevBtn" disabled>‚Üê Previous</button>
            <span id="currentVerseRef" style="text-align: center; font-weight: bold;">Select a verse</span>
            <button class="nav-button" onclick="nextVerse()" id="nextBtn" disabled>Next ‚Üí</button>
            <div></div>
        </div>
        
        <div class="verse-preview" id="versePreview">
            <h3 id="verseReference"></h3>
            <div class="verse-text" id="verseText"></div>
        </div>
        
        <button onclick="displayVerse()" id="displayBtn" disabled>Display Verse</button>
        <button onclick="hideVerse()" class="hide">Hide Verse</button>
    </div>
    
    <div class="container">
        <h2>Speaker Name</h2>
        <div class="form-group">
            <label for="speakerInput">Speaker Name</label>
            <input type="text" id="speakerInput" placeholder="Enter speaker name">
        </div>
        <button onclick="displaySpeaker()">Display Speaker</button>
        <button onclick="hideSpeaker()" class="hide">Hide Speaker</button>
    </div>
    
    <div class="container">
        <h2>Text Search</h2>
        <div class="form-group">
            <label for="searchInput">Search Bible</label>
            <input type="text" id="searchInput" placeholder="Search verses..." oninput="searchBible()">
        </div>
        <div class="search-results" id="searchResults" style="display: none;"></div>
    </div>

    <script>
        let ws;
        let selectedBook = '';
        let selectedChapter = 0;
        let selectedVerse = 0;
        let currentAutocompleteIndex = -1;
        let books = [];
        let currentBookData = null;
        let currentVerseData = null;

        // Theme toggle function
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                themeToggle.textContent = '‚òÄÔ∏è';
                themeToggle.title = 'Toggle Light Mode';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light-mode');
                themeToggle.textContent = 'üåô';
                themeToggle.title = 'Toggle Dark Mode';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'dark') {
                body.classList.remove('light-mode');
                themeToggle.textContent = '‚òÄÔ∏è';
                themeToggle.title = 'Toggle Light Mode';
            } else {
                body.classList.add('light-mode');
                themeToggle.textContent = 'üåô';
                themeToggle.title = 'Toggle Dark Mode';
            }
        });

        // Navigation functions
        function previousVerse() {
            if (!currentBookData || !selectedBook || selectedChapter === 0 || selectedVerse === 0) return;
            
            if (selectedVerse > 1) {
                // Previous verse in same chapter
                selectVerse(selectedBook, selectedChapter, selectedVerse - 1);
            } else if (selectedChapter > 1) {
                // Last verse of previous chapter
                const prevChapter = selectedChapter - 1;
                const prevChapterVerses = currentBookData.chapters[prevChapter - 1].length;
                selectVerse(selectedBook, prevChapter, prevChapterVerses);
            } else {
                // Last verse of last chapter of previous book
                const currentBookIndex = books.findIndex(book => book.abbrev === selectedBook || book.name === selectedBook);
                if (currentBookIndex > 0) {
                    const prevBook = books[currentBookIndex - 1];
                    const lastChapter = prevBook.chapters.length;
                    const lastVerse = prevBook.chapters[lastChapter - 1].length;
                    selectVerse(prevBook.abbrev, lastChapter, lastVerse);
                }
            }
        }

        function nextVerse() {
            if (!currentBookData || !selectedBook || selectedChapter === 0 || selectedVerse === 0) return;
            
            const currentChapterVerses = currentBookData.chapters[selectedChapter - 1].length;
            
            if (selectedVerse < currentChapterVerses) {
                // Next verse in same chapter
                selectVerse(selectedBook, selectedChapter, selectedVerse + 1);
            } else if (selectedChapter < currentBookData.chapters.length) {
                // First verse of next chapter
                selectVerse(selectedBook, selectedChapter + 1, 1);
            } else {
                // First verse of first chapter of next book
                const currentBookIndex = books.findIndex(book => book.abbrev === selectedBook || book.name === selectedBook);
                if (currentBookIndex < books.length - 1) {
                    const nextBook = books[currentBookIndex + 1];
                    selectVerse(nextBook.abbrev, 1, 1);
                }
            }
        }

        function selectVerse(book, chapter, verse) {
            selectedBook = book;
            selectedChapter = chapter;
            selectedVerse = verse;
            
            // Update the book selector
            const bookInput = document.getElementById('bookInput');
            const foundBook = books.find(b => b.abbrev === book || b.name === book);
            if (foundBook) {
                bookInput.value = foundBook.name;
                currentBookData = foundBook;
                
                // Request chapters for this book
                requestChapters(foundBook.abbrev);
                
                // Update chapter selector
                setTimeout(() => {
                    const chapterSelect = document.getElementById('chapterSelect');
                    chapterSelect.value = chapter;
                    chapterSelect.disabled = false;
                    
                    // Request verses for this chapter
                    requestVerses(foundBook.abbrev, chapter);
                    
                    // Update verse selector
                    setTimeout(() => {
                        const verseSelect = document.getElementById('verseSelect');
                        verseSelect.value = verse;
                        verseSelect.disabled = false;
                        
                        // Get and preview the verse
                        requestVersePreview(foundBook.abbrev, chapter, verse);
                        updateNavigationButtons();
                    }, 100);
                }, 100);
            }
        }

        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const currentRef = document.getElementById('currentVerseRef');
            
            console.log('updateNavigationButtons called:', {
                currentBookData: !!currentBookData,
                selectedBook,
                selectedChapter,
                selectedVerse
            });
            
            if (!currentBookData || !selectedBook || selectedChapter === 0 || selectedVerse === 0) {
                prevBtn.disabled = true;
                nextBtn.disabled = true;
                currentRef.textContent = 'Select a verse';
                console.log('Navigation buttons disabled - missing data');
                return;
            }
            
            const foundBook = books.find(b => b.abbrev === selectedBook || b.name === selectedBook);
            if (foundBook) {
                currentRef.textContent = `${foundBook.name} ${selectedChapter}:${selectedVerse}`;
            }
            
            // Check if previous verse exists
            const currentBookIndex = books.findIndex(book => book.abbrev === selectedBook || book.name === selectedBook);
            const canGoPrev = !(currentBookIndex === 0 && selectedChapter === 1 && selectedVerse === 1);
            prevBtn.disabled = !canGoPrev;
            
            // Check if next verse exists
            const currentChapterVerses = currentBookData.chapters[selectedChapter - 1].length;
            const isLastVerseOfChapter = selectedVerse === currentChapterVerses;
            const isLastChapter = selectedChapter === currentBookData.chapters.length;
            const isLastBook = currentBookIndex === books.length - 1;
            const canGoNext = !(isLastVerseOfChapter && isLastChapter && isLastBook);
            nextBtn.disabled = !canGoNext;
            
            console.log('Navigation buttons updated:', {
                canGoPrev,
                canGoNext,
                prevDisabled: prevBtn.disabled,
                nextDisabled: nextBtn.disabled
            });
        }

        function connect() {
            ws = new WebSocket('ws://localhost:8080/ws/control');
            
            ws.onopen = function() {
                console.log('Connected to server');
                document.getElementById('status').className = 'status connected';
                document.getElementById('status').textContent = 'Connected to server';
                
                // Load initial book list
                requestBooks();
            };
            
            ws.onclose = function() {
                console.log('Disconnected from server');
                document.getElementById('status').className = 'status disconnected';
                document.getElementById('status').textContent = 'Disconnected from server - Retrying...';
                setTimeout(connect, 3000);
            };
            
            ws.onmessage = function(event) {
                const data = JSON.parse(event.data);
                
                switch(data.type) {
                    case 'books_response':
                        handleBooksResponse(data.books);
                        break;
                    case 'chapters_response':
                        handleChaptersResponse(data.chapters);
                        break;
                    case 'verses_response':
                        handleVersesResponse(data.verses);
                        break;
                    case 'search_results':
                        handleSearchResults(data.results);
                        break;
                    case 'verse_preview':
                        showVersePreview(data.verse);
                        break;
                }
            };
        }

        function requestBooks(filter = '') {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'get_books',
                    filter: filter
                }));
            }
        }

        function requestChapters(book) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'get_chapters',
                    book: book
                }));
            }
        }

        function requestVerses(book, chapter) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'get_verses',
                    book: book,
                    chapter: chapter
                }));
            }
        }

        function requestVerse(book, chapter, verse) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'get_verse',
                    book: book,
                    chapter: chapter,
                    verse: verse
                }));
            }
        }

        function requestVersePreview(book, chapter, verse) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'preview_verse',
                    book: book,
                    chapter: chapter,
                    verse: verse
                }));
            }
        }

        function handleBooksResponse(bookList) {
            books = bookList;
            showBookDropdown(bookList);
        }

        function handleChaptersResponse(chapters) {
            const chapterSelect = document.getElementById('chapterSelect');
            chapterSelect.innerHTML = '<option value="">Select chapter</option>';
            
            chapters.forEach(chapter => {
                const option = document.createElement('option');
                option.value = chapter;
                option.textContent = chapter;
                chapterSelect.appendChild(option);
            });
            
            chapterSelect.disabled = false;
            document.getElementById('verseSelect').disabled = true;
            document.getElementById('verseSelect').innerHTML = '<option value="">Select verse</option>';
            hideVersePreview();
        }

        function handleVersesResponse(verses) {
            const verseSelect = document.getElementById('verseSelect');
            verseSelect.innerHTML = '<option value="">Select verse</option>';
            
            verses.forEach(verse => {
                const option = document.createElement('option');
                option.value = verse;
                option.textContent = verse;
                verseSelect.appendChild(option);
            });
            
            verseSelect.disabled = false;
            hideVersePreview();
        }

        function handleSearchResults(results) {
            const searchResults = document.getElementById('searchResults');
            searchResults.innerHTML = '';
            
            if (results.length > 0) {
                searchResults.style.display = 'block';
                results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = 'search-result';
                    div.innerHTML = `
                        <div class="verse-reference">${result.book} ${result.chapter}:${result.verse}</div>
                        <div class="verse-text">${result.text}</div>
                    `;
                    div.onclick = () => selectSearchResult(result);
                    searchResults.appendChild(div);
                });
            } else {
                searchResults.style.display = 'none';
            }
        }

        function selectSearchResult(result) {
            // Set the book, chapter, and verse selections
            document.getElementById('bookInput').value = result.book;
            selectedBook = result.book;
            
            // Request chapters for this book
            requestChapters(result.book);
            
            // Set chapter and verse when chapters load
            setTimeout(() => {
                document.getElementById('chapterSelect').value = result.chapter;
                selectedChapter = result.chapter;
                
                // Request verses for this chapter
                requestVerses(result.book, result.chapter);
                
                // Set verse when verses load
                setTimeout(() => {
                    document.getElementById('verseSelect').value = result.verse;
                    selectedVerse = result.verse;
                    showVersePreview(result);
                }, 100);
            }, 100);
            
            hideBookDropdown();
            document.getElementById('searchResults').style.display = 'none';
        }

        function showBookDropdown(bookList) {
            const dropdown = document.getElementById('bookDropdown');
            dropdown.innerHTML = '';
            
            bookList.forEach((book, index) => {
                const div = document.createElement('div');
                div.className = 'autocomplete-item';
                if (index === currentAutocompleteIndex) {
                    div.classList.add('selected');
                }
                div.textContent = book;
                div.onclick = () => selectBook(book);
                dropdown.appendChild(div);
            });
            
            dropdown.style.display = bookList.length > 0 ? 'block' : 'none';
        }

        function hideBookDropdown() {
            document.getElementById('bookDropdown').style.display = 'none';
            currentAutocompleteIndex = -1;
        }

        function selectBook(book) {
            document.getElementById('bookInput').value = book;
            selectedBook = book;
            selectedChapter = 0; // Reset chapter
            selectedVerse = 0; // Reset verse
            hideBookDropdown();
            
            // Reset chapter and verse
            document.getElementById('chapterSelect').innerHTML = '<option value="">Select chapter</option>';
            document.getElementById('verseSelect').innerHTML = '<option value="">Select verse</option>';
            document.getElementById('verseSelect').disabled = true;
            hideVersePreview();
            updateNavigationButtons();
            
            // Store current book data
            currentBookData = books.find(b => b.abbrev === book || b.name === book);
            
            // Request chapters for this book
            requestChapters(book);
        }

        function showVersePreview(verse) {
            document.getElementById('verseReference').textContent = `${verse.book} ${verse.chapter}:${verse.verse}`;
            document.getElementById('verseText').textContent = verse.text;
            document.getElementById('versePreview').style.display = 'block';
            document.getElementById('displayBtn').disabled = false;
            // Update navigation buttons when verse is shown
            updateNavigationButtons();
        }

        function hideVersePreview() {
            document.getElementById('versePreview').style.display = 'none';
            document.getElementById('displayBtn').disabled = true;
        }

        function searchBible() {
            const query = document.getElementById('searchInput').value;
            if (query.trim() && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'search',
                    query: query
                }));
            } else {
                document.getElementById('searchResults').style.display = 'none';
            }
        }

        function displayVerse() {
            if (selectedBook && selectedChapter && selectedVerse) {
                requestVerse(selectedBook, selectedChapter, selectedVerse);
            }
        }

        function hideVerse() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'bible',
                    show: false
                }));
            }
        }

        function displaySpeaker() {
            const speaker = document.getElementById('speakerInput').value;
            if (speaker && ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'speaker',
                    speaker: speaker,
                    show: true
                }));
            }
        }

        function hideSpeaker() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'speaker',
                    show: false
                }));
            }
        }

        // Book input event handlers
        document.getElementById('bookInput').addEventListener('input', function() {
            const filter = this.value;
            currentAutocompleteIndex = -1;
            if (filter.trim()) {
                requestBooks(filter);
            } else {
                hideBookDropdown();
            }
        });

        document.getElementById('bookInput').addEventListener('keydown', function(e) {
            const dropdown = document.getElementById('bookDropdown');
            const items = dropdown.children;
            
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                currentAutocompleteIndex = Math.min(currentAutocompleteIndex + 1, items.length - 1);
                updateDropdownSelection();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                currentAutocompleteIndex = Math.max(currentAutocompleteIndex - 1, -1);
                updateDropdownSelection();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                if (currentAutocompleteIndex >= 0 && items[currentAutocompleteIndex]) {
                    selectBook(items[currentAutocompleteIndex].textContent);
                }
            } else if (e.key === 'Escape') {
                hideBookDropdown();
            }
        });

        document.getElementById('bookInput').addEventListener('blur', function() {
            // Delay hiding to allow click events
            setTimeout(hideBookDropdown, 100);
        });

        function updateDropdownSelection() {
            const items = document.getElementById('bookDropdown').children;
            for (let i = 0; i < items.length; i++) {
                items[i].classList.toggle('selected', i === currentAutocompleteIndex);
            }
        }

        // Chapter select handler
        document.getElementById('chapterSelect').addEventListener('change', function() {
            selectedChapter = parseInt(this.value);
            selectedVerse = 0; // Reset verse selection
            if (selectedChapter && selectedBook) {
                // Ensure currentBookData is set
                if (!currentBookData) {
                    currentBookData = books.find(b => b.abbrev === selectedBook || b.name === selectedBook);
                }
                requestVerses(selectedBook, selectedChapter);
            } else {
                document.getElementById('verseSelect').disabled = true;
                document.getElementById('verseSelect').innerHTML = '<option value="">Select verse</option>';
                hideVersePreview();
            }
            updateNavigationButtons();
        });

        // Verse select handler  
        document.getElementById('verseSelect').addEventListener('change', function() {
            selectedVerse = parseInt(this.value);
            if (selectedVerse && selectedBook && selectedChapter) {
                // Ensure currentBookData is set
                if (!currentBookData) {
                    currentBookData = books.find(b => b.abbrev === selectedBook || b.name === selectedBook);
                }
                // Request the actual verse text for preview
                requestVersePreview(selectedBook, selectedChapter, selectedVerse);
                updateNavigationButtons();
            } else {
                hideVersePreview();
                updateNavigationButtons();
            }
        });

        // Connect on page load
        connect();
    </script>
</body>
</html>
